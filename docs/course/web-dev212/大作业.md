# 大作业题目
使用vue3制作一个支持多用户登录的待办清单

详细要求及说明待续...

# 远程数据库使用

项目要求使用后端 JSON 存储

- 可以使用[Pantry](getpantry.cloud)等第三方提供的数据库
- 也可以使用本课程提供的[json-server](https://github.com/typicode/json-server)

## Pantry使用方法
参考 https://getpantry.cloud

待续...

## json-server 使用方法
本课程已在阿里云上搭建好了数据库，简单的使用方法如下，详情请参考[github](https://github.com/typicode/json-server)。

url: http://47.99.244.42:2999
key: 私发给每个同学 

重要：数据是一个数组，数组元素是一个个的对象，每个对象代表一个用户，每个用户必须有一个 id 作为用户名

示例如下（可以用 6TTP6PL 这个 key 来访问，大家尽量只读这个key的数据，不要去修改）：

```js
;[
  {
    id: "guyong",
    password: "guyong123",
    name: "辜勇",
    tasks: [
      {
        name: "Steal bananas from supermarket.",
        status: "in-progress",
      },
      {
        name: "Eat 1 kg chocolate in 1 hour",
        status: "finished",
      },
      {
        name: "Create YouTude video.",
        status: "finished",
      },
      {
        name: "learn vuejs in 2 weeks",
        status: "in-progress",
      },
      {
        name: "Eat 1 kg chocolate in 3 hour",
        status: "to-do",
      },
    ],
  },
  {
    id: "john",
    password: "john",
    name: "匿名",
    tasks: [],
  },
]
```

### 读取用户名为 id 的数据

```js
const myHeaders = new Headers()
myHeaders.append("Content-Type", "application/json")
let requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow",
}
fetch(`${url}/${key}/${id}`, requestOptions)
  .then((response) => response.json())
  .then((data) => {
    if (data.id === id) {
      return data
    } else {
      throw new Error("用户名不存在")
    }
  })
  .catch((err) => console.log(err))
```

### 更改用户名为 id 的数据为 userData

注意：该用户必须已经存在，且 id 是不可更改的

```js
const myHeaders = new Headers()
myHeaders.append("Content-Type", "application/json")
let requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow",
}

const userData = {
  id: "john",
  password: "john123",
  name: "John Smith",
  tasks: [
    {
      name: "learn vuejs in 2 weeks",
      status: "in-progress",
    },
  ],
}
requestOptions.body = JSON.stringify(userData)
fetch(`${url}/${key}/${this.userData.id}`, requestOptions)
  .then((response) => {
    this.log({
      msg: "Save data succeed",
      type: 1,
    })
  })
  .catch((err) => {
    this.log({
      msg: err.message,
      type: -1,
    })
  })
```

### 注册新用户（用户名为 id, 用户密码为 pwd)

注意：要先判断该用户名是否已经存在

```js
const myHeaders = new Headers()
myHeaders.append("Content-Type", "application/json")
let requestOptions = {
  method: "GET",
  headers: myHeaders,
  redirect: "follow",
}

fetch(`${url}/${key}/${id}`, requestOptions)
  .then((response) => response.json())
  .then((data) => {
    if (data.id === id) {
      throw new Error("用户名已存在")
    } else {
      return true
    }
  })
  .then(() => {
    requestOptions.method = "POST"
    requestOptions.body = JSON.stringify({
      id: id,
      password: pwd,
      name: "匿名",
      tasks: [],
    })
    return fetch(`${url}/${key}`, requestOptions)
  })
```
